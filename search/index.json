[{"content":"Ansible has many scopes to store a variable state/value enabling flexibility for configurations in a hardware/virtual machine inventory.\nAt the time of playbook execution, Ansible applies variable precedence to derive the value/state for a given variable.\nHere is the order of precedence from least to greatest (the last listed variables override all other variables):\n   command line values (for example, -u my_user, these are not variables)\n  role defaults (defined in role/defaults/main.yml) 1\n  inventory file or script group vars 2\n  inventory group_vars/all 3\n  playbook group_vars/all 3\n  inventory group_vars/* 3\n  playbook group_vars/* 3\n  inventory file or script host vars 2\n  inventory host_vars/* 3\n  playbook host_vars/* 3\n  host facts / cached set_facts 4\n  play vars\n  play vars_prompt\n  play vars_files\n  role vars (defined in role/vars/main.yml)\n  block vars (only for tasks in block)\n  task vars (only for the task)\n  include_vars\n  set_facts / registered vars\n  role (and include_role) params\n  include params\n  extra vars (for example, -e \u0026quot;user=my_user\u0026quot;)(always win precedence)\n   In general, Ansible gives precedence to variables that were defined more recently, more actively, and with more explicit scope. Variables in the defaults folder inside a role are easily overridden. Anything in the vars directory of the role overrides previous versions of that variable in the namespace. Host and/or inventory variables override role defaults, but explicit includes such as the vars directory or an include_vars task override inventory variables. [1].\nSuppose we have a group of applications for a given VM, each with it own set of configuration parameters.\nFor example, consider a stack of applications running on a docker machine.\nTake the following docker-compose example:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86  version:\u0026#39;3\u0026#39;services:web:image:ansible/awx:18.container_name:awx_webdepends_on:- redis- postgresports:- \u0026#34;80:8052\u0026#34;hostname:awxwebuser:rootrestart:unless-stoppedvolumes:- supervisor-socket:/var/run/supervisor- rsyslog-socket:/var/run/awx-rsyslog/- rsyslog-config:/var/lib/awx/rsyslog/- \u0026#34;~/.awx/awxcompose/SECRET_KEY:/etc/tower/SECRET_KEY\u0026#34;- \u0026#34;~/.awx/awxcompose/environment.sh:/etc/tower/conf.d/environment.sh\u0026#34;- \u0026#34;~/.awx/awxcompose/credentials.py:/etc/tower/conf.d/credentials.py\u0026#34;- \u0026#34;~/.awx/awxcompose/nginx.conf:/etc/nginx/nginx.conf:ro\u0026#34;- \u0026#34;~/.awx/awxcompose/redis_socket:/var/run/redis/:rw\u0026#34;environment:http_proxy:https_proxy:no_proxy:task:image:ansible/awx:17.1.0container_name:awx_taskdepends_on:- redis- web- postgrescommand:/usr/bin/launch_awx_task.shhostname:awxuser:rootrestart:unless-stoppedvolumes:- supervisor-socket:/var/run/supervisor- rsyslog-socket:/var/run/awx-rsyslog/- rsyslog-config:/var/lib/awx/rsyslog/- \u0026#34;~/.awx/awxcompose/SECRET_KEY:/etc/tower/SECRET_KEY\u0026#34;- \u0026#34;~/.awx/awxcompose/environment.sh:/etc/tower/conf.d/environment.sh\u0026#34;- \u0026#34;~/.awx/awxcompose/credentials.py:/etc/tower/conf.d/credentials.py\u0026#34;- \u0026#34;~/.awx/awxcompose/redis_socket:/var/run/redis/:rw\u0026#34;environment:AWX_SKIP_MIGRATIONS:\u0026#34;1\u0026#34;http_proxy:https_proxy:no_proxy:SUPERVISOR_WEB_CONFIG_PATH:\u0026#39;/etc/supervisord.conf\u0026#39;redis:image:rediscontainer_name:awx_redisrestart:unless-stoppedenvironment:http_proxy:https_proxy:no_proxy:command:[\u0026#34;/usr/local/etc/redis/redis.conf\u0026#34;]volumes:- \u0026#34;~/.awx/awxcompose/redis.conf:/usr/local/etc/redis/redis.conf:ro\u0026#34;- \u0026#34;~/.awx/awxcompose/redis_socket:/var/run/redis/:rw\u0026#34;postgres:image:postgres:12container_name:awx_postgresrestart:unless-stoppedvolumes:- \u0026#34;~/.awx/pgdocker/12/data/:/var/lib/postgresql/data:Z\u0026#34;environment:POSTGRES_USER:awxPOSTGRES_PASSWORD:pgpassPOSTGRES_DB:awxhttp_proxy:https_proxy:no_proxy:volumes:supervisor-socket:rsyslog-socket:rsyslog-config:  References [1]https://docs.ansible.com/ansible/latest/user_guide/playbooks_variables.html#understanding-variable-precedence\n","date":"2022-03-05T00:00:00Z","permalink":"https://dettonville.github.io/p/ansible-considerations-for-app-container-configurations/","title":"Ansible considerations for app container configurations"},{"content":"  In an effort to resurrect my long neglected blogdown site, I decided to switch to a new theme. It is possible to use blogdown::install_theme() to get you started adding a new theme. But I wanted to do the update manually and then start to modify the theme to suit my needs. For R coders sometimes other languages and interacting with HTML and CSS can be intimidating but the results are very satisfying. I also think that tools like rmarkdown and shiny have forced us to know enough about web languages to work things out. This post is a record of the steps I took to change to and then modify a new Hugo theme, plus some of the small gotcha’s I encountered along the way.\nFirst find a good theme On the Hugo themes website there are almost 300 to choose from. The themes website is well designed so it is easy to filter and sort to find the theme you are after. Make sure you find one with good documentation and an example website for you to better understand how it all fits together. Not all documentation is created equally so it is worth taking the time at the start to work through it.\nAnother thing to remember is that themes can have different requirements for structuring your blogs content. So also check the example website’s structure to assess how much effort is required to adapt your site.\nIn my work life I generally have to use standard corporate themes. My previous theme was the wonderful future imperfect but this time I wanted to try something darker and something good for displaying photos. I also wanted a theme that:\nis responsive and looks good on a phone is good for displaying photos has a good simple search function displays tags nicely  Eventually I decided on the stack theme by Jimmy Cai. Some extra features that clinched the deal were:\nability to toggle between light and dark themes local search PhotoSwipe integration an archive page template no built in JavaScript or CSS frameworks  This last point, I hope, will lead to less conflicts when adding htmlwidgets to posts.\n Import new theme To import the theme I just followed the documentation and imported the theme using git clone before setting up the theme as a sub-module.\ngit clone https://github.com/CaiJimmy/hugo-theme-stack/ themes/hugo-theme-stack git submodule add https://github.com/CaiJimmy/hugo-theme-stack/ themes/hugo-theme-stack These are the usual instructions for adding a theme. But adding the theme as a sub-module is optional. You will need to make some changes to the contents of the theme and you will also want to keep track of these changes in git. Using the code above the sub-module points to the original source, but you may not want to push your changes to this repo.\nAfter a while I removed the sub-module and added the theme to the sites repo. To do this you need to use the git deinit command but you also need to delete cached files from the git repo. I did this based on a Stack Overflow answer which is copied below.\nmv themes/hugo-theme-stack themes/hugo-theme-stack_tmp git themes/hugo-theme-stack deinit themes/hugo-theme-stack git rm --cached themes/hugo-theme-stack mv themes/hugo-theme-stack_tmp subfolder git add themes/hugo-theme-stack  Update the Config file Now it is time to update your sites config.toml or config.yaml file. Remember we selected a theme that has an example website. So rename your old config file and copy across the one from the new theme example. Then you can go through updating the new config file based on the old one. With luck this will be enough to get your site running using blogdown::build_site() then blogdown::serve_site().\n Update site structure At this stage it becomes pretty obvious what is working and what is not. For me, the new theme had a different structure to deal with pages like about. Using the new config file and the structure of the example site I was able to adapt to this pretty easily.\nThe biggest issue I had was trying to update the page logo. This is just a .jpg file for both the old and new theme. It took a long time to realise that the new theme expected this file to be in the themes/hugo-theme-stack/assets/img folder when the old theme expected it to be in static/img. In both cases you refer to the file using img/logo.jpg, so I could not understand what I was doing wrong.\n Exploring the Theme contents It is worth having a good idea of the structure and the files in the theme. There will be lots of instances where it is best to make changes in the theme as this will cascade through the site. For example, I wanted to use highlight.js for syntax highlighting. This can be done with 3 lines of code:\n\u0026lt;link rel=\u0026quot;stylesheet\u0026quot; href=\u0026quot;https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.0.1/styles/a11y-dark.min.css\u0026quot;\u0026gt; \u0026lt;script src=\u0026quot;https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.0.1/highlight.min.js\u0026quot;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script\u0026gt;hljs.highlightAll();\u0026lt;/script\u0026gt; Of course you can add this to each post, but if you add it to the theme it becomes available to all posts. This are where Hugo partial templates become really powerful. A partial is a small html template. On build all of the partials get joined together to form the full page. These small chunks are much easier to maintain and are often parametised and will vary depending on site and page settings and content.\nIn the themes/hugo-theme-stack/layouts/partials/head folder, there is a file called script.html. In the base theme the file is empty but is intended to be modified. There were also files called:\n head.html custom.html style.html   .right { display: block; float: right; width: 20%; }  I used the custom.html file to include all the links needed to add a favicon to my site. The svg for the favicon was created in Inkscape, then I used RealFaviconGenerator to convert to a favicon. This is the same service behind pkgdown’s pkgdown::build_favicon() function.\nThe last change to the theme I made (for now) was to add the read time for each article at the top of the page. Reading time is available in the Hugo page variable .ReadingTime. Hugo calculates reading time as (words + 212) / 213. After looking through all the files in the theme, I found that the themes/hugo-theme-stack/layouts/partials/article/components/details contained all of the page information such as title, description, and publish date. After finding the place to put the reading time I only need to add the following two span tags to get a book icon and the calculated read time.\n\u0026lt;span\u0026gt;{{ partial \u0026quot;helper/icon\u0026quot; \u0026quot;book\u0026quot; }}\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;meta__text post-word-count\u0026quot;\u0026gt;{{ .ReadingTime }} min read\u0026lt;/span\u0026gt; The book icon was not a standard part of the theme. Luckily in the stack theme all of the icons have been generated using Tabler Icons and so it was easy create one that matched perfectly.\nAdd comments In my previous site I used Disqus for comments but this time I wanted to try utterances. Utterances uses Github issues to manage comments. As my site is in a Github repo and is hosted via Github pages, it made sense to have one less account to manage. First the utterances app needs to be installed onto the repo where you want the comments to go. Then you can use the utterances configuration site to generate a code snippet that needs to be inserted into each page.\n\u0026lt;script src=\u0026quot;https://utteranc.es/client.js\u0026quot; repo=\u0026quot;[ENTER REPO HERE]\u0026quot; issue-term=\u0026quot;pathname\u0026quot; theme=\u0026quot;github-light\u0026quot; crossorigin=\u0026quot;anonymous\u0026quot; async\u0026gt; \u0026lt;/script\u0026gt; Again, the stack theme was a good choice as utterances is already part of the theme. All I needed to do to configure was add the code below to the config.yaml.\n comments: enabled: true provider: utterances utterances: repo: mrjoh3/blog issueTerm: pathname label: comment  Time to add content And that, as they say, was that. The site is up and running with the new theme. I have made some minor changes to the theme and am quite happy. Really, where I did have issues I should have read the documentation more carefully. At the start of this post I said “pick a theme with good documentation and an example site.” While updating and modifying the theme I have been referring the the theme documentation regularly. It is always helpful, plus the example site meant I saved an enormous amount of time when restructuring the site to suite the theme.\nNow that I am up and running, I just need to get to the hard part of adding content. Hopefully this post is a good start.\n  ","date":"2021-06-24T00:00:00Z","image":"https://dettonville.github.io/img/DSCN1968_edited-1_20070804_165511_002.jpg","permalink":"https://dettonville.github.io/p/updating-a-blog-theme/","title":"Changing and modifying a Hugo theme on your R Blogdown site"}]