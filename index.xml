<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>Platforms, Clusters, and Pipelines, oh my...</title>
        <link>https://dettonville.github.io/</link>
        <description>Recent content on Platforms, Clusters, and Pipelines, oh my...</description>
        <generator>Hugo -- gohugo.io</generator>
        <language>en-us</language>
        <lastBuildDate>Sat, 05 Mar 2022 00:00:00 +0000</lastBuildDate><atom:link href="https://dettonville.github.io/index.xml" rel="self" type="application/rss+xml" /><item>
        <title>Ansible Limitations with respect to Application Configuration on a target host and workarounds</title>
        <link>https://dettonville.github.io/p/ansible-limitations-with-respect-to-application-configuration-on-a-target-host-and-workarounds/</link>
        <pubDate>Sat, 05 Mar 2022 00:00:00 +0000</pubDate>
        
        <guid>https://dettonville.github.io/p/ansible-limitations-with-respect-to-application-configuration-on-a-target-host-and-workarounds/</guid>
        <description>&lt;p&gt;If one has worked long enough with ansible, you might have gotten to the same frustation I have had.&lt;/p&gt;
&lt;p&gt;Ansible has many scopes to store a variable value allowing for its supreme flexibility for maintaining a hardware/virtual machine inventory.&lt;/p&gt;
&lt;p&gt;For example, for a target host VM instance, one can set the variable state at the host level in the inventory.&lt;/p&gt;
&lt;p&gt;Another possibility, is if the setting is not unique to the machine, and if there are a group of such machines (pet / cattle), then one can set the variable state at the respective group level.&lt;/p&gt;
&lt;p&gt;Just this support enables a large diversity of use cases where the scenario is one-to-many between group to machine.&lt;/p&gt;
&lt;p&gt;Then one has the an array of additional options to further overide a variable state other levels:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;- at the playbook level by setting the variable upon playbook execution
- at runtime level, by setting the variable input file
- at environment level, by using lookup(env, )
- etc, etc,...
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;For the challenge that occurs in realistic application environments, DEV, TEST, PROD, STAGE, etc, consider the following simplistic but realistic scenario:&lt;/p&gt;
&lt;p&gt;Say we have a stack of application components belonging to the same overall application and for a given host machine, that multiple application components are to be hosted/running on the machine, each with it own set of configuration parameters.&lt;/p&gt;
&lt;p&gt;Make the scenario more realistic by considering a stack of applications running on a docker machine.&lt;/p&gt;
&lt;p&gt;Take the following docker-compose example:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;60
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;61
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;62
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;63
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;64
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;65
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;66
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;67
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;68
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;69
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;70
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;71
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;72
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;73
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;74
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;75
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;76
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;77
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;78
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;79
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;80
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;81
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;82
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;83
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;84
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;85
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;86
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;version: &amp;#39;3&amp;#39;
services:

  web:
    image: ansible/awx:18.
    container_name: awx_web
    depends_on:
      - redis
      - postgres
    ports:
      - &amp;#34;80:8052&amp;#34;
    hostname: awxweb
    user: root
    restart: unless-stopped
    volumes:
      - supervisor-socket:/var/run/supervisor
      - rsyslog-socket:/var/run/awx-rsyslog/
      - rsyslog-config:/var/lib/awx/rsyslog/
      - &amp;#34;~/.awx/awxcompose/SECRET_KEY:/etc/tower/SECRET_KEY&amp;#34;
      - &amp;#34;~/.awx/awxcompose/environment.sh:/etc/tower/conf.d/environment.sh&amp;#34;
      - &amp;#34;~/.awx/awxcompose/credentials.py:/etc/tower/conf.d/credentials.py&amp;#34;
      - &amp;#34;~/.awx/awxcompose/nginx.conf:/etc/nginx/nginx.conf:ro&amp;#34;
      - &amp;#34;~/.awx/awxcompose/redis_socket:/var/run/redis/:rw&amp;#34;
    environment:
      http_proxy: 
      https_proxy: 
      no_proxy: 

  task:
    image: ansible/awx:17.1.0
    container_name: awx_task
    depends_on:
      - redis
      - web
      - postgres
    command: /usr/bin/launch_awx_task.sh
    hostname: awx
    user: root
    restart: unless-stopped
    volumes:
      - supervisor-socket:/var/run/supervisor
      - rsyslog-socket:/var/run/awx-rsyslog/
      - rsyslog-config:/var/lib/awx/rsyslog/
      - &amp;#34;~/.awx/awxcompose/SECRET_KEY:/etc/tower/SECRET_KEY&amp;#34;
      - &amp;#34;~/.awx/awxcompose/environment.sh:/etc/tower/conf.d/environment.sh&amp;#34;
      - &amp;#34;~/.awx/awxcompose/credentials.py:/etc/tower/conf.d/credentials.py&amp;#34;
      - &amp;#34;~/.awx/awxcompose/redis_socket:/var/run/redis/:rw&amp;#34;
    environment:
      AWX_SKIP_MIGRATIONS: &amp;#34;1&amp;#34;
      http_proxy: 
      https_proxy: 
      no_proxy: 
      SUPERVISOR_WEB_CONFIG_PATH: &amp;#39;/etc/supervisord.conf&amp;#39;

  redis:
    image: redis
    container_name: awx_redis
    restart: unless-stopped
    environment:
      http_proxy: 
      https_proxy: 
      no_proxy: 
    command: [&amp;#34;/usr/local/etc/redis/redis.conf&amp;#34;]
    volumes:
      - &amp;#34;~/.awx/awxcompose/redis.conf:/usr/local/etc/redis/redis.conf:ro&amp;#34;
      - &amp;#34;~/.awx/awxcompose/redis_socket:/var/run/redis/:rw&amp;#34;

  postgres:
    image: postgres:12
    container_name: awx_postgres
    restart: unless-stopped
    volumes:
      - &amp;#34;~/.awx/pgdocker/12/data/:/var/lib/postgresql/data:Z&amp;#34;
    environment:
      POSTGRES_USER: awx
      POSTGRES_PASSWORD: pgpass
      POSTGRES_DB: awx
      http_proxy: 
      https_proxy: 
      no_proxy: 


volumes:
  supervisor-socket:
  rsyslog-socket:
  rsyslog-config:
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;</description>
        </item>
        
    </channel>
</rss>
